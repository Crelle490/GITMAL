<!DOCTYPE html>
<html>
<!-- AUTOGENERATED HTML from CourseBuilder, CEF -->
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
<body style='font-family: times new roman, times, serif;font-size: 12pt;color: #000000;'>

Der er adgang til en GPU baseret server ifbm kurset.  Serveren består af en
&#x27;master&#x27; som kan tilgås via

<dl>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/'>gpucluster.st.lab.au.dk/</a></span>
</dl>

og fem &#x27;slave&#x27; noder med GPU&#x27;er via

<dl>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/jhub1'>gpucluster.st.lab.au.dk/jhub1</a></span>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/jhub2'>gpucluster.st.lab.au.dk/jhub2</a></span>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/jhub3'>gpucluster.st.lab.au.dk/jhub3</a></span>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/jhub4'>gpucluster.st.lab.au.dk/jhub4</a></span>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/jhub4'>gpucluster.st.lab.au.dk/jhub4</a></span>
<dd><span style='font-family: courier new, courier;'><a href='http://gpucluster.st.lab.au.dk/jhub5'>gpucluster.st.lab.au.dk/jhub5</a></span> (GPU 3090 og ny 4GHz CPU, 3090 har problemer med Tensorflow)
</dl>

som frit kan benyttes.

<p>Adgang kræver at i er på EDUROAM eller VPN/au access.</p>

<p>Der er pt. ingen load-balancing på de fire noder så se på gpucluster hjemmesiden, hvilke noder der er mindst belastede (via TOP
dataen).</p>

<h3>Brug</h3>

<p>Alle grupper har fået deres egen konto, og f.eks. så logger Grp 09 ind som:</p>

<dl>
<dd>Login: f21mal09
<dd>Password: f21mal09_123
</dl>

<p>Dvs. brugernavn/login f21malXX hvor XX er jeres ITMAL gruppe og password sammen som brugernavn med med _123
tilføjet.</p>

<h3>Quick Guide</h3>

<dl>
<dt>GIT via Jupyter:
<dd>I kan clone git repositoret via en &#x27;!&#x27;-shell commando i Jupyter notepad&#x27;en
<dd><span style='font-family: courier new, courier;'>! git clone https://cfrigaard@bitbucket.org/cfrigaard/itmal</span>
<dd>og så herefter pull&#x27;e via
<dd><span style='font-family: courier new, courier;'>! cd itmal &amp;&amp; git pull</span>

<dt>PYTHONPATH
<dd>NOTE: PYTHONPATH er IKKE sat (som vi gjorde i L03/modules_and _classes.ipynb), men kan simuleres via
<dd><span style='font-family: courier new, courier;'>import sys,os sys.path.append(os.path.expanduser(&#x27;~/itmal&#x27;))</span>
</dl>

<p>Hvis du kloner <span style='font-family: courier new, courier;'>[GITMAL]</span> til itmal som overnfor er der nu automatisk sat en path op til libitaml, prøv det!</p>

<h3>GPU Hukommelse</h3>

<p>Ved brug af Keras+GPU allokeres automatisk al GPU hukommelse.  Når vi er flere brugere skal i derfor indsætte
følgende i starten af jeres Keras/Tensorflow Jupyternotebook kode:</p>

<pre style='margin-left: 30px;'><code>
import tensorflow as tf
from keras.backend.tensorflow_backend import set_session
config = tf.ConfigProto()
config.gpu_options.per_process_gpu_memory_fraction = 0.05
config.gpu_options.allow_growth=True
set_session(tf.Session(config=config))
</code></pre>

eller blot

<pre style='margin-left: 30px;'><code>
from libitmal import kernelfuns as itmalkernelfuns
itmalkernelfuns.EnableGPU()
</code></pre>

<p>så allokeres kun en brøkdel af GPU hukommelsen!  Det ser ud til at growth=True ikke virker, så sæt
per_process_gpu_memory_fraction op hvis i har behov.</p>

<p>Der kører nu et automatisk startup-script når i logger ind/åbner en nodebook. Se</p>

<pre style='margin-left: 30px;'><code>/home/shared/(??)/startup/00_init.py</code></pre>

<p>der kører StartupSequence_SetPath() og StartupSequence_EnableGPU(), den sidste unktion med følgende default
paramete</p>

<pre style='margin-left: 30px;'><code>def StartupSequence_EnableGPU(gpu_mem_fraction=0.05, gpus=None, cpus=None)</code></pre>

<p>Bemærk at jeres jupyter server, beholder all hukommelse, også når i logger af...kun &quot;stop my server&quot;/&quot;start server&quot;
frigiver!</p>




<h3>Noter</h3>

<p>Terminal på cluster: brug Jupyter notebooks terminalen. Herefter har du en fin terminal på cluster noden</p>

<p>SSH til cluster: eller gør det på den klassiske metode via SSH til clusterens &#x27;masternode&#x27; via</p>

<pre style='margin-left: 30px;'><code>&gt; ssh -p 443 gpucluster.st.lab.au.dk</code></pre>

<p>og herfra videre til &#x27;noder&#x27; via ssh node 1 til node 5, f.eks.</p>

<pre style='margin-left: 30px;'><code>&gt; ssh node3</code></pre>

<p>Brug ikke &#x27;masternode&#x27;en til udregninger, kun node 1 til 5!</p>

<p>Sæt gerne jeres SSH certifickater på, så i slipper for login/password.</p>

<p>Password kan kun ændres via SSH og <span style='font-family: courier new, courier;'>&gt; passwd</span></p>

<p>Se Hvad der kører på CPU</p>

<pre style='margin-left: 30px;'><code>! top -n1</code></pre>

<p>Se Hvad der kører på GPU</p>

<pre style='margin-left: 30px;'><code>! nvidia-smi</code></pre>

<p>Kill din egne processer</p>

<pre style='margin-left: 30px;'><code>! kill -9 &lt;pid&gt;</code></pre>

<p>eller</p>

<pre style='margin-left: 30px;'><code>! pkill &lt;procesnavn&gt;</code></pre>







</body>
</html>